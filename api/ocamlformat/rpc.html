<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>rpc (ocamlformat.rpc)</title><meta charset="utf-8"/><link rel="stylesheet" href="../_odoc-theme/odoc.css"/><meta name="generator" content="odoc 2.4.4"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="index.html">Up</a> â€“ <a href="index.html">ocamlformat</a> &#x00BB; rpc</nav><header class="odoc-preamble"><h1 id="ocamlformat-rpc"><a href="#ocamlformat-rpc" class="anchor"></a>ocamlformat-rpc</h1><p><code>ocamlformat-rpc</code> is a RPC mode for OCamlFormat, a tool to format OCaml code.</p><p><code>ocamlformat-rpc</code> listens to RPC requests, provided on the standard input, and prints the response on the standard output. See the <a href="manpage_ocamlformat_rpc.html" title="manpage_ocamlformat_rpc">manpage</a> for options.</p></header><nav class="odoc-toc"><ul><li><a href="#agreeing-on-a-rpc-version">Agreeing on a RPC version</a></li><li><a href="#commands">Commands</a><ul><li><a href="#version-1">Version 1</a></li><li><a href="#version-2">Version 2</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="agreeing-on-a-rpc-version"><a href="#agreeing-on-a-rpc-version" class="anchor"></a>Agreeing on a RPC version</h2><p>Before the client and the server agree on a common version to use the following commands are available:</p><ul><li><code>Halt</code> to close the connection to the RPC. The command is encoded as the canonical s-expression <code>Atom &quot;Halt&quot;</code>;</li><li><code>Version &lt;v&gt;</code> to ask the server to use version <code>v</code>. The command expects a canonical s-expression of the form <code>List [Atom &quot;Version&quot;; Atom v]</code> where <code>v</code> is of the version name (e.g. <code>&quot;v1&quot;</code>).</li></ul><p>If the server agrees upon the version he will send the reply <code>Version v</code> and the protocol version is set to <code>v</code>, to use another version later the client has to close the connexion and start a new one. If the server cannot use version <code>v</code> he might propose another version <code>w</code> by sending the reply <code>Version w</code> that the client can accept by sending the same request for version <code>w</code>, or propose another version. If the server cannot propose another version it will close the connection. Unknown commands are ignored.</p><p>Once the client and the server agree on a common version, the requests you can send may differ from one version to another.</p><h2 id="commands"><a href="#commands" class="anchor"></a>Commands</h2><p><code>ocamlformat-rpc</code> accepts different commands depending on the version agreed upon.</p><h3 id="version-1"><a href="#version-1" class="anchor"></a>Version 1</h3><ul><li><code>Halt</code> to end the communication with the RPC server. The caller must close the input and output channels.</li><li><code>(Config (options...))</code>: submits a list of formatting options (please refer to <a href="manpage_ocamlformat_rpc.html" title="manpage_ocamlformat_rpc">the manpage</a> to know more about the available options). The server answer with the accepted configuration. The configuration can be reset to its default value by sending the pair <code>(profile default)</code>.</li><li><code>(Format x)</code>: submits a string to be formatted. It attempts to successively format <code>x</code> as a <code>core_type</code>, a <code>signature</code>, a <code>module_type</code>, an <code>expression</code> and a <code>use_file</code>, stopping at the first successful formatting. The formatted output is sent as a reply of the same form.</li></ul><h3 id="version-2"><a href="#version-2" class="anchor"></a>Version 2</h3><ul><li><code>Halt</code> to end the communication with the RPC server. The caller must close the input and output channels.</li><li><code>(Format x options...)</code>: submits a string to be formatted. It attempts to successively format <code>x</code> as a <code>core_type</code>, a <code>signature</code>, a <code>module_type</code>, an <code>expression</code> and a <code>use_file</code>, stopping at the first successful formatting. The formatted output is sent as a reply of the same form. The options are:</li></ul><ol><li><code>(Path p)</code> sets the path to the formatted file.</li><li><code>(Config config)</code> sets the formatting options. <code>config</code> is a list of options, for example: <code>((profile default) (parse-docstrings true))</code> See <a href="manpage_ocamlformat.html" title="manpage_ocamlformat">this page</a> for the available formatting options.</li></ol><p>Unknown commands are ignored.</p><p>All the commands take canonical s-expressions. To build your RPC client to interact with <code>ocamlformat-rpc</code> please refer to the library <code>ocamlformat-rpc-lib</code>.</p></div></body></html>
