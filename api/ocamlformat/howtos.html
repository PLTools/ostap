<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>howtos (ocamlformat.howtos)</title><meta charset="utf-8"/><link rel="stylesheet" href="../_odoc-theme/odoc.css"/><meta name="generator" content="odoc 2.4.4"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="index.html">Up</a> â€“ <a href="index.html">ocamlformat</a> &#x00BB; howtos</nav><header class="odoc-preamble"><h1 id="how-to's"><a href="#how-to's" class="anchor"></a>How-To's</h1><p>Using an autoformatter will make your process easier but it can also introduce a few pain points. Here are how to solve the most commonly encountered pain points.</p></header><nav class="odoc-toc"><ul><li><a href="#using-ocamlformat-without-breaking-git-blame">Using OCamlFormat without breaking <code>git blame</code></a></li><li><a href="#resolve-merge-conflicts-using-merge-fmt-and-ocamlformat">Resolve merge conflicts using Merge-fmt and OCamlFormat</a><ul><li><a href="#standalone">Standalone</a></li><li><a href="#as-a-git-mergetool">As a Git mergetool</a></li><li><a href="#as-a-git-merge-driver">As a git merge driver</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="using-ocamlformat-without-breaking-git-blame"><a href="#using-ocamlformat-without-breaking-git-blame" class="anchor"></a>Using OCamlFormat without breaking <code>git blame</code></h2><ul><li>Create <code>.git-blame-ignore-revs</code> in your project</li><li>Add revision(s) where the code was re-formatted</li></ul><pre class="language-ocaml"><code># Apply new formatting with OCamlFormat
2ceaf76b9f84cb632327c1479d0f30acfa3eeba2</code></pre><ul><li>Run <code>git config --local blame.ignoreRevsFile .git-blame-ignore-revs</code></li><li>All future use of <code>git blame</code> will now provide blame information omitting the reformatting commits: lines that were changed or added by an ignored commit will be blamed on the previous commit that changed that line or nearby lines.</li></ul><h2 id="resolve-merge-conflicts-using-merge-fmt-and-ocamlformat"><a href="#resolve-merge-conflicts-using-merge-fmt-and-ocamlformat" class="anchor"></a>Resolve merge conflicts using Merge-fmt and OCamlFormat</h2><p><a href="https://github.com/hhugo/merge-fmt">Merge-fmt</a> is a small wrapper on top of <code>git</code> commands to help resolve conflicts caused by code formatters.</p><p>There are three ways to use <code>merge-fmt</code>.</p><h3 id="standalone"><a href="#standalone" class="anchor"></a>Standalone</h3><p>Just call <code>merge-fmt</code> while there are unresolved conflicts. <code>merge-fmt</code> will try to resolve conflicts automatically.</p><h3 id="as-a-git-mergetool"><a href="#as-a-git-mergetool" class="anchor"></a>As a Git mergetool</h3><p><code>merge-fmt</code> can act as a git <a href="https://git-scm.com/docs/git-mergetool">mergetool</a>. First configure the current git repository with</p><pre class="language-ocaml"><code>merge-fmt setup-mergetool
git config --local mergetool.mergefmt.cmd 'merge-fmt mergetool --base=$BASE --current=$LOCAL --other=$REMOTE -o $MERGED'
git config --local mergetool.mergefmt.trustExitCode true</code></pre><p>Then, use <code>git mergetool</code> to resolve conflicts with <code>git mergetool -t mergefmt</code>.</p><h3 id="as-a-git-merge-driver"><a href="#as-a-git-merge-driver" class="anchor"></a>As a git merge driver</h3><p><code>merge-fmt</code> can act as a git <a href="https://git-scm.com/docs/gitattributes">merge driver</a>. Configure the current git repository to use <code>merge-fmt</code> as the default merge driver.</p><pre class="language-ocaml"><code>$ merge-fmt setup-merge
git config --local merge.mergefmt.name 'merge-fmt driver'
git config --local merge.mergefmt.driver 'merge-fmt mergetool --base=%O --current=%A --other=%B -o %A --name=%P'
git config --local merge.tool 'mergefmt'
git config --local merge.default 'mergefmt'</code></pre></div></body></html>
